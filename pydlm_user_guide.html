

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Dynamic linear models — user manual &mdash; PyDLM 0.1.1 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="PyDLM 0.1.1 documentation" href="index.html"/>
        <link rel="next" title="The discouting factor" href="discounting.html"/>
        <link rel="prev" title="A simple example" href="example.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> PyDLM
          

          
          </a>

          
            
            
              <div class="version">
                0.1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="example.html">A simple example</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Dynamic linear models &#8212; user manual</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#miscellaneous">Miscellaneous</a></li>
<li class="toctree-l2"><a class="reference internal" href="#modeling">Modeling</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-components">Model components</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#trend">Trend</a></li>
<li class="toctree-l3"><a class="reference internal" href="#seasonality">Seasonality</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dynamic">Dynamic</a></li>
<li class="toctree-l3"><a class="reference internal" href="#auto-regression">Auto-regression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#long-seasonality">Long-seasonality</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-fitting">Model fitting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-prediction">Model prediction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-amending">Model amending</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#adding-new-data">Adding new data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deleting-existing-data">Deleting existing data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#ignoring-a-date">Ignoring a date</a></li>
<li class="toctree-l3"><a class="reference internal" href="#modify-data">modify data</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-plotting">Model plotting</a></li>
<li class="toctree-l2"><a class="reference internal" href="#model-tuning-and-evaluation">Model Tuning and evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-settings">Advanced Settings</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="discounting.html">The discouting factor</a></li>
<li class="toctree-l1"><a class="reference internal" href="class_ref.html">Class Reference</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">PyDLM</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Dynamic linear models &#8212; user manual</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/pydlm_user_guide.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="dynamic-linear-models-user-manual">
<h1>Dynamic linear models &#8212; user manual<a class="headerlink" href="#dynamic-linear-models-user-manual" title="Permalink to this headline">¶</a></h1>
<p>This package implements the Bayesian dynamic linear model (DLM, Harrison
and West, 1999) for time series analysis.
The DLM is built upon two layers. The first layer is
the fitting algorithm. DLM adopts a modified Kalman filter with a
unique discounting technique from
Harrison and West (1999). Like the usual Kalman filter, it accepts a
transition matrix, a measurement matrix, an observation, a latent
state, an innovation and an error covariance matrix and return the
updated state and error covariance. These quantities will all be
supplied internally &#8211; users are free from any annoying
calculations. Different from the usual Kalman filter, the modified
Kalman filter does not require the tuning of the two parameters: the
error covariance matrix and the observational variance, so the model
fitting is extremely efficient (could be up to 1000 times faster than
the EM algorithm), more details will be provided in the section of the
discounting technique.</p>
<p>The second layer of DLM is itsmodeling feature. Nicely summarized in
Harrison and West (1999), most common models can be expressed in
one unified form &#8211; canonical form, which is closely related to the
Jordan decomposition. Thanks to this keen observation, the DLM can
easily incorporate most modeling components and turn them into the
corresponding transition matrices and other quantities to be supplied
to the Kalman filter. Examples are trend, seasonality, holidays,
control variables and auto-regressive, which could appear
simultaneously in one model. Due to this nice property, users of this
package can construct models simply by &#8220;adding&#8221; some component into
the model as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span> <span class="o">=</span> <span class="n">dlm</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>The modeling process is simple.</p>
<p>The purpose of the modeling is to better understand the time series
data and for to forecast into the future. So the key output from the
model are the filtered time series, smoothed time series and one-step
ahead prediction. We will cover this topic later in this section.</p>
<p>The advantage of <a class="reference internal" href="index.html#module-pydlm" title="pydlm"><code class="xref py py-mod docutils literal"><span class="pre">pydlm</span></code></a>:</p>
<blockquote>
<div><ul class="simple">
<li>flexibility in constructing complicated models</li>
<li>Extremely efficient model fitting with the discounting technique</li>
<li>user-specific adjustment on the adaptive property of the model</li>
</ul>
</div></blockquote>
<p>The disadvantage of <a class="reference internal" href="index.html#module-pydlm" title="pydlm"><code class="xref py py-mod docutils literal"><span class="pre">pydlm</span></code></a>:</p>
<blockquote>
<div><ul class="simple">
<li>only for Gaussian noise</li>
</ul>
</div></blockquote>
<div class="section" id="miscellaneous">
<h2>Miscellaneous<a class="headerlink" href="#miscellaneous" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><cite>PyDLM</cite> index starts at 0 instead of 1, i.e., for any prediction or
modification that involves <cite>date</cite> argument, it corresponds to the
actual index in the array. For instance, for a time series with
length 10, the date of the last day is 9.</li>
</ul>
</div>
<div class="section" id="modeling">
<h2>Modeling<a class="headerlink" href="#modeling" title="Permalink to this headline">¶</a></h2>
<p>As discussed in the beginning, the modeling process is very simple
with <a class="reference internal" href="index.html#module-pydlm" title="pydlm"><code class="xref py py-mod docutils literal"><span class="pre">pydlm</span></code></a>, most modeling functions are integrated in the class
<a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a>. Following is an example for constructing a dlm with
linear trend, 7-day seasonality and control variables:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydlm</span> <span class="k">import</span> <span class="n">dlm</span><span class="p">,</span> <span class="n">trend</span><span class="p">,</span> <span class="n">seasonality</span><span class="p">,</span> <span class="n">dynamic</span><span class="p">,</span> <span class="n">autoReg</span><span class="p">,</span> <span class="n">longSeason</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span> <span class="o">+</span> <span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">SP500Index</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2000</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[[</span><span class="mi">2010</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)]</span>
<span class="n">page</span> <span class="o">=</span> <span class="p">[[</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">)]</span>
<span class="n">myDLM</span> <span class="o">=</span> <span class="n">dlm</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">myDLM</span> <span class="o">=</span> <span class="n">myDLM</span> <span class="o">+</span> <span class="n">trend</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trend1&#39;</span><span class="p">)</span>
<span class="n">myDLM</span> <span class="o">=</span> <span class="n">myDLM</span> <span class="o">+</span> <span class="n">seasonality</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;week&#39;</span><span class="p">)</span>
<span class="n">myDLM</span> <span class="o">=</span> <span class="n">myDLM</span> <span class="o">+</span> <span class="n">dynamic</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">SP500Index</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;SP500&#39;</span><span class="p">)</span>
<span class="n">myDLM</span> <span class="o">=</span> <span class="n">myDLM</span> <span class="o">+</span> <span class="n">dynamic</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">page</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;page&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>User can also use <a class="reference internal" href="class_ref.html#pydlm.dlm.add" title="pydlm.dlm.add"><code class="xref py py-func docutils literal"><span class="pre">dlm.add()</span></code></a> method to add new component:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">trend</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trend2&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>The imput <code class="xref py py-attr docutils literal"><span class="pre">data</span></code> must be an 1d array or a list, since the current
<a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a> only supports one dimensional time series. Supporting for
multivariate time series will be built upon this one dimensional class
and added in the future.</p>
<p>Now the variable <cite>myDLM</cite> contains the data and the modeling
information. It will construct the corresponding transition,
measurement, innovation, latent states and error covariance matrix
once model fitting is called. Modify an existing model is also
simple. User can brows the existing components of the model by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>
</div>
<p>It will show all the existing components and their corresponding
names. Name can be specified when the component is added to the <cite>dlm</cite>,
for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span> <span class="o">=</span> <span class="n">myDLM</span> <span class="o">+</span> <span class="n">seasonality</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;day4&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">ls</span><span class="p">()</span>
</pre></div>
</div>
<p>We can also easily delete the unwanted component by using <cite>delete</cite>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;trend2&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s1">&#39;day4&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>After the building steps, we can specify some parameters for the model
fitting, the most common one is the prior guess on the observational
noise. The default value is 1.0. To change that to 10 you can do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">noisePrior</span><span class="p">(</span><span class="mf">10.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Such change usually has small impact on the model and is almost
ignorable.</p>
</div>
<div class="section" id="model-components">
<h2>Model components<a class="headerlink" href="#model-components" title="Permalink to this headline">¶</a></h2>
<p>There are four model components provided with this
package: trend, seasonality, dynamic and the auto-regression.</p>
<div class="section" id="trend">
<h3>Trend<a class="headerlink" href="#trend" title="Permalink to this headline">¶</a></h3>
<p><a class="reference internal" href="class_ref.html#pydlm.trend" title="pydlm.trend"><code class="xref py py-class docutils literal"><span class="pre">trend</span></code></a> class is a model component for trend
behavior. The data might be const or increasing linearly or
quadraticly, which can all be captured by <a class="reference internal" href="class_ref.html#pydlm.trend" title="pydlm.trend"><code class="xref py py-class docutils literal"><span class="pre">trend</span></code></a>. The degree
argument specifics the shape of the trend. <cite>degree=0</cite> indicates this
is a const, <cite>degree=1</cite> indicates a line and <cite>degree=2</cite> stands for a
quadratic curve and so on so forth. <cite>w</cite> sets the prior
covariance for the trend component (same for all the other
components). The discounting factor will be explained later in next
section:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">linearTrend</span> <span class="o">=</span> <span class="n">trend</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trend1&#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="n">e7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="seasonality">
<h3>Seasonality<a class="headerlink" href="#seasonality" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="class_ref.html#pydlm.seasonality" title="pydlm.seasonality"><code class="xref py py-class docutils literal"><span class="pre">seasonality</span></code></a> class models the periodic behavior of the
data. Compared to the sine or cosine periodic curves,
<a class="reference internal" href="class_ref.html#pydlm.seasonality" title="pydlm.seasonality"><code class="xref py py-class docutils literal"><span class="pre">seasonality</span></code></a> in this packages is more flexible, since it can
turn into any shapes, much broader than the triangular families:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">weekPeriod</span> <span class="o">=</span> <span class="n">seasonality</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;week&#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="n">e7</span><span class="p">)</span>
</pre></div>
</div>
<p>In the package, we implements the seasonality component in a
<cite>form-free</cite> way (Harrison and West, 1999) to avoid the identifiability
issue. The states of one seasonality component are always summed up to
zero, so that it will not tangle with the <a class="reference internal" href="class_ref.html#pydlm.trend" title="pydlm.trend"><code class="xref py py-class docutils literal"><span class="pre">trend</span></code></a> component.</p>
</div>
<div class="section" id="dynamic">
<h3>Dynamic<a class="headerlink" href="#dynamic" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="class_ref.html#pydlm.dynamic" title="pydlm.dynamic"><code class="xref py py-class docutils literal"><span class="pre">dynamic</span></code></a> class offers the modeling ability to add any additional
observed time series as a controlled variable to the current one. For
example, when studying the stock price, the &#8216;SP500&#8217; index could be a
good indicator for the modeling stock. A dynamic component need the
user to supply the necessary information of the control variable over
time:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">SP500</span> <span class="o">=</span> <span class="n">dynamic</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="n">SP500Index</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;SP500&#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="n">e7</span><span class="p">)</span>
</pre></div>
</div>
<p>The input <code class="xref py py-attr docutils literal"><span class="pre">features</span></code> for <a class="reference internal" href="class_ref.html#pydlm.dynamic" title="pydlm.dynamic"><code class="xref py py-class docutils literal"><span class="pre">dynamic</span></code></a> should be a list of
lists, since multi-dimension features are allowed. Following is one
simple example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">Features</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2000</span><span class="p">],</span> <span class="p">[</span><span class="mi">2010</span><span class="p">],</span> <span class="p">[</span><span class="mi">2020</span><span class="p">],</span> <span class="p">[</span><span class="mi">2030</span><span class="p">]]</span>
<span class="n">Features</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="section" id="auto-regression">
<h3>Auto-regression<a class="headerlink" href="#auto-regression" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="class_ref.html#pydlm.autoReg" title="pydlm.autoReg"><code class="xref py py-class docutils literal"><span class="pre">autoReg</span></code></a> class constructs the auto-regressive component on
the model, i.e., the direct linear or non-linear dependency between
the current observation and the previous days. User needs to specify
the number of days of the dependency:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">AR3</span> <span class="o">=</span> <span class="n">autoReg</span><span class="p">(</span><span class="n">degree</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">discount</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;ar3&#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="n">e7</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, the latent stats for Auto-regression are aligned in a
way of [today - 3, today - 2, today - 1]. So when fetching the
coefficients from the latent states, this will be the correct order to
read the coefficients.</p>
</div>
<div class="section" id="long-seasonality">
<h3>Long-seasonality<a class="headerlink" href="#long-seasonality" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="class_ref.html#pydlm.longSeason" title="pydlm.longSeason"><code class="xref py py-class docutils literal"><span class="pre">longSeason</span></code></a> class is a complement class for
<a class="reference internal" href="class_ref.html#pydlm.seasonality" title="pydlm.seasonality"><code class="xref py py-class docutils literal"><span class="pre">seasonality</span></code></a>. It allows constructing seasonality component that
does not change every step. For example, the time unit is day, but
user wants to add a monthly seasonality, then <a class="reference internal" href="class_ref.html#pydlm.longSeason" title="pydlm.longSeason"><code class="xref py py-class docutils literal"><span class="pre">longSeason</span></code></a> is
the correct choice:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">monthly</span> <span class="o">=</span> <span class="n">longSeason</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">stay</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;monthly&#39;</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">1</span><span class="n">e7</span><span class="p">)</span>
</pre></div>
</div>
<p>These five classes of model components offer abundant modeling
possiblities of the Bayesian dynamic linear model. Users can construct
very complicated models using these components, such as hourly, weekly or
monthly periodicy and holiday indicator and many other features.</p>
</div>
</div>
<div class="section" id="model-fitting">
<h2>Model fitting<a class="headerlink" href="#model-fitting" title="Permalink to this headline">¶</a></h2>
<p>Entailed before, the fitting of the dlm is fulfilled by a modified
Kalman filter. Once the user finished constructing the model by adding
different components. the <a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a> will compute all the necessary
quantities internally for using Kalman filter. So users can simply
call <a class="reference internal" href="class_ref.html#pydlm.dlm.fitForwardFilter" title="pydlm.dlm.fitForwardFilter"><code class="xref py py-func docutils literal"><span class="pre">dlm.fitForwardFilter()</span></code></a>, <a class="reference internal" href="class_ref.html#pydlm.dlm.fitBackwardSmoother" title="pydlm.dlm.fitBackwardSmoother"><code class="xref py py-func docutils literal"><span class="pre">dlm.fitBackwardSmoother()</span></code></a> or
even simply <a class="reference internal" href="class_ref.html#pydlm.dlm.fit" title="pydlm.dlm.fit"><code class="xref py py-func docutils literal"><span class="pre">dlm.fit()</span></code></a> to fit both forward filter and backward
smoother:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">fitForwardFilter</span><span class="p">()</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">fitBackwardSmoother</span><span class="p">()</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="class_ref.html#pydlm.dlm.fitForwardFilter" title="pydlm.dlm.fitForwardFilter"><code class="xref py py-func docutils literal"><span class="pre">dlm.fitForwardFilter()</span></code></a> is implemented in an online
manner. It keeps an internal count on the filtered dates and once new
data comes in, it only filters the new data without touching the
existing results. In addition, this function also allows a rolling
window fitting on the data, i.e., there will be a moving window and
for each date, the kalman filter will only use the data within the
window to filter the observation. This is equivalent to that the model
only remembers a fixed length of dates:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">fitForwardFilter</span><span class="p">(</span><span class="n">useRollingWindow</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">windowLength</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">fitBackwardSmoother</span><span class="p">()</span>
</pre></div>
</div>
<p>For <code class="xref py py-func docutils literal"><span class="pre">dlm.backwardSmoother()</span></code>, it has to use the whole time series
to smooth the latent states once new data comes in. The smoothing
provides a good retrospective analysis on our past decision of the
data. For example, we might initially believe the time series is
stable, while that could be a random behavior within a volatile time
series, and the user learn this from the smoother.</p>
<p>Once the model fitting is completed, users can fetch the filtered or
smoothed results from <a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">getMean</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;forwardFilter&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">getMean</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;backwardSmoother&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">getMean</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;predict&#39;</span><span class="p">)</span>

<span class="n">myDLM</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;forwardFilter&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;backwardSmoother&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;predict&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a> recomputes a wide variety of model quantities that
can be extracted by the user. For example, user can get the filtered
states and covariance by typing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">getLatentState</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;forwardFilter&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">getLatentState</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;backwardSmoother&#39;</span><span class="p">)</span>

<span class="n">myDLM</span><span class="o">.</span><span class="n">getLatentCov</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;forwardFilter&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">getLatentCov</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;backwardSmoother&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>This can be specified into individual component. For example, assume the
model contains a <a class="reference internal" href="class_ref.html#pydlm.trend" title="pydlm.trend"><code class="xref py py-class docutils literal"><span class="pre">trend</span></code></a> component with a name of <cite>trend1</cite>, we
can extract the corresponding latent state only for <cite>trend1</cite> as:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">getLatentState</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;forwardFilter&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trend1&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">getLatentState</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;backwardSmoother&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trend1&#39;</span><span class="p">)</span>

<span class="n">myDLM</span><span class="o">.</span><span class="n">getLatentCov</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;forwardFilter&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trend1&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">getLatentCov</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;backwardSmoother&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trend1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>as well as the mean of <cite>trend1</cite> (evaluation * latent states):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">getMean</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;forwardFilter&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trend1&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;forwardFilter&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;trend1&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>One can also get the confidence interval on the filtered time series:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">geInterval</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;forwardFilter&#39;</span><span class="p">,</span> <span class="n">p</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">)</span>
</pre></div>
</div>
<p>There are also corresponding methods for smoothed and predicted
results. For more detail, please refer to the <a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a> class
documentation.</p>
</div>
<div class="section" id="model-prediction">
<h2>Model prediction<a class="headerlink" href="#model-prediction" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a> provides three predict functions: <a class="reference internal" href="class_ref.html#pydlm.dlm.predict" title="pydlm.dlm.predict"><code class="xref py py-func docutils literal"><span class="pre">dlm.predict()</span></code></a> and
<a class="reference internal" href="class_ref.html#pydlm.dlm.continuePredict" title="pydlm.dlm.continuePredict"><code class="xref py py-func docutils literal"><span class="pre">dlm.continuePredict()</span></code></a> and <a class="reference internal" href="class_ref.html#pydlm.dlm.predictN" title="pydlm.dlm.predictN"><code class="xref py py-func docutils literal"><span class="pre">dlm.predictN()</span></code></a>. The last one is
wrapper of the former two and is recommended to use. (The former two
will be gradually deprecated).</p>
<p>The <a class="reference internal" href="class_ref.html#pydlm.dlm.predict" title="pydlm.dlm.predict"><code class="xref py py-func docutils literal"><span class="pre">dlm.predict()</span></code></a> is a one-day ahead
prediction function based on a user given date and feature set:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># predict next date after the time series</span>
<span class="n">featureDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SP500&#39;</span><span class="p">:[</span><span class="mi">2090</span><span class="p">],</span> <span class="s1">&#39;page&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]}</span>
<span class="p">(</span><span class="n">predictMean</span><span class="p">,</span> <span class="n">predictVar</span><span class="p">)</span> <span class="o">=</span> <span class="n">myDLM</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">myDLM</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">featureDict</span><span class="o">=</span><span class="n">featureDict</span><span class="p">)</span>
</pre></div>
</div>
<p>The function returns a tuple of predicted mean and predicted variance.
The <cite>featureDict</cite> argument is a dictionary contains the feature
information for <a class="reference internal" href="class_ref.html#pydlm.dynamic" title="pydlm.dynamic"><code class="xref py py-class docutils literal"><span class="pre">dynamic</span></code></a> component. Suppose the model contains
a one-dimensional dynamic component named <cite>SP500</cite> and another
four-dimensional dynamic component <cite>page</cite>, then the featureDict takes the
following Form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">featureDict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SP500&#39;</span><span class="p">:[</span><span class="mi">2090</span><span class="p">],</span> <span class="s1">&#39;page&#39;</span><span class="p">:[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">]}</span>
</pre></div>
</div>
<p>If the <cite>featureDict</cite> is not supplied but the date is not the last day,
then the algorithm will automatically fetch from the old data about
the feature value of all the dynamic component:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># predict a day in the middle</span>
<span class="p">(</span><span class="n">predictMean</span><span class="p">,</span> <span class="n">predictVar</span><span class="p">)</span> <span class="o">=</span> <span class="n">myDLM</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">myDLM</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<p>The algorithm will use the feature on the date of <cite>myDLM.n - 9</cite> in
<cite>featureDict</cite>. If date is the last day but the featureDict is not
provided, then an error will be raised.</p>
<p>If the user is interested beyond one-day ahead prediction, they can
use <a class="reference internal" href="class_ref.html#pydlm.dlm.continuePredict" title="pydlm.dlm.continuePredict"><code class="xref py py-func docutils literal"><span class="pre">dlm.continuePredict()</span></code></a> for multiple-day ahead prediction,
after using <a class="reference internal" href="class_ref.html#pydlm.dlm.predict" title="pydlm.dlm.predict"><code class="xref py py-func docutils literal"><span class="pre">dlm.predict()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">feature1</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SP500&#39;</span><span class="p">:[</span><span class="mi">2090</span><span class="p">],</span> <span class="s1">&#39;page&#39;</span><span class="p">:[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]}</span>
<span class="n">feature2</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SP500&#39;</span><span class="p">:[</span><span class="mi">2010</span><span class="p">],</span> <span class="s1">&#39;page&#39;</span><span class="p">:[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">41</span><span class="p">]}</span>
<span class="n">feature3</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SP500&#39;</span><span class="p">:[</span><span class="mi">1990</span><span class="p">],</span> <span class="s1">&#39;page&#39;</span><span class="p">:[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">42</span><span class="p">]}</span>

<span class="c1"># one-day ahead prediction after the last day</span>
<span class="p">(</span><span class="n">predictMean</span><span class="p">,</span> <span class="n">predictVar</span><span class="p">)</span> <span class="o">=</span> <span class="n">myDLM</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">date</span><span class="o">=</span><span class="n">myDLM</span><span class="o">.</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">featureDict</span><span class="o">=</span><span class="n">feature1</span><span class="p">)</span>
<span class="c1"># we continue to two-day ahead prediction after the last day</span>
<span class="p">(</span><span class="n">predictMean</span><span class="p">,</span> <span class="n">predictVar</span><span class="p">)</span> <span class="o">=</span> <span class="n">myDLM</span><span class="o">.</span><span class="n">continuePredict</span><span class="p">(</span><span class="n">featureDict</span><span class="o">=</span><span class="n">feature2</span><span class="p">)</span>
<span class="c1"># we continue to three-day ahead prediction after the last day</span>
<span class="p">(</span><span class="n">predictMean</span><span class="p">,</span> <span class="n">predictVar</span><span class="p">)</span> <span class="o">=</span> <span class="n">myDLM</span><span class="o">.</span><span class="n">continuePredict</span><span class="p">(</span><span class="n">featureDict</span><span class="o">=</span><span class="n">feature3</span><span class="p">)</span>
</pre></div>
</div>
<p><a class="reference internal" href="class_ref.html#pydlm.dlm.continuePredict" title="pydlm.dlm.continuePredict"><code class="xref py py-func docutils literal"><span class="pre">dlm.continuePredict()</span></code></a> can only be used after <a class="reference internal" href="class_ref.html#pydlm.dlm.predict" title="pydlm.dlm.predict"><code class="xref py py-func docutils literal"><span class="pre">dlm.predict()</span></code></a>
for multiple-day prediction. The <cite>featureDict</cite> can also be ignored if
the prediction is requested on dates before the last day and the
features on the predict day can be found from the old data.</p>
<p><a class="reference internal" href="class_ref.html#pydlm.dlm.predictN" title="pydlm.dlm.predictN"><code class="xref py py-func docutils literal"><span class="pre">dlm.predictN()</span></code></a> (recommended) predicts over multiple days and is
a wrapper of the two functions above. Using the same example, the
results can be obtained by just called:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">features</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;SP500&#39;</span><span class="p">:[[</span><span class="mi">2090</span><span class="p">],</span> <span class="p">[</span><span class="mi">2010</span><span class="p">],</span> <span class="p">[</span><span class="mi">1990</span><span class="p">]],</span> <span class="s1">&#39;page&#39;</span><span class="p">:[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span>
<span class="mi">40</span><span class="p">],</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">41</span><span class="p">],</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">42</span><span class="p">]]}</span>
<span class="p">(</span><span class="n">predictMean</span><span class="p">,</span> <span class="n">predictVar</span><span class="p">)</span> <span class="o">=</span> <span class="n">myDLM</span><span class="o">.</span><span class="n">predictN</span><span class="p">(</span><span class="n">N</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">myDLM</span><span class="o">.</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
<span class="n">featureDict</span><span class="o">=</span><span class="n">features</span><span class="p">)</span>
</pre></div>
</div>
<p>The <cite>predictMean</cite> and <cite>predictVar</cite> will be two lists of three elements
containing the predicted mean and variance.</p>
</div>
<div class="section" id="model-amending">
<h2>Model amending<a class="headerlink" href="#model-amending" title="Permalink to this headline">¶</a></h2>
<p>The user can still add, delete, modify data even when the model has
been constructed.</p>
<div class="section" id="adding-new-data">
<h3>Adding new data<a class="headerlink" href="#adding-new-data" title="Permalink to this headline">¶</a></h3>
<p>For adding more data, user can opt to
<a class="reference internal" href="class_ref.html#pydlm.dlm.append" title="pydlm.dlm.append"><code class="xref py py-func docutils literal"><span class="pre">dlm.append()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">newData</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newData</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="s1">&#39;main&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If the model contains <a class="reference internal" href="class_ref.html#pydlm.dynamic" title="pydlm.dynamic"><code class="xref py py-class docutils literal"><span class="pre">dynamic</span></code></a> component, the corresponding
features need to be updated as well:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">newSP500</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">2000</span><span class="p">],</span> <span class="p">[</span><span class="mi">2100</span><span class="p">],</span> <span class="p">[</span><span class="mi">2200</span><span class="p">]]</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">newSP500</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="s1">&#39;SP500&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Then the user can rerun the forward filter:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">fitForwardFilter</span><span class="p">()</span>
</pre></div>
</div>
<p>The package will continue running the forward filter on the three new
data ponts.</p>
</div>
<div class="section" id="deleting-existing-data">
<h3>Deleting existing data<a class="headerlink" href="#deleting-existing-data" title="Permalink to this headline">¶</a></h3>
<p>To delete any existing data, user can simply use the <a class="reference internal" href="class_ref.html#pydlm.dlm.popout" title="pydlm.dlm.popout"><code class="xref py py-func docutils literal"><span class="pre">dlm.popout()</span></code></a>
function from <a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a> on a specific date, for example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">popout</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
<p>Different from <a class="reference internal" href="class_ref.html#pydlm.dlm.append" title="pydlm.dlm.append"><code class="xref py py-func docutils literal"><span class="pre">dlm.append()</span></code></a>, <a class="reference internal" href="class_ref.html#pydlm.dlm.popout" title="pydlm.dlm.popout"><code class="xref py py-func docutils literal"><span class="pre">dlm.popout()</span></code></a> will be executed
automatically for all components, so the user does not need to conduct
the deletion mannually for each component. After the deletion, the
forward filter needs to be rerun following the deleted date:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">fitForwardFilter</span><span class="p">()</span>
</pre></div>
</div>
<p>Again, the package will automatically recognize the date and fit only
the necessary period of time.</p>
</div>
<div class="section" id="ignoring-a-date">
<h3>Ignoring a date<a class="headerlink" href="#ignoring-a-date" title="Permalink to this headline">¶</a></h3>
<p>Ignoring is very similar to deleting. The only difference is the time
counts. Because deleting will delete the data entirely, the time
counts will therefore reduce by 1. By contrast, ignoring will treat
the specific date as missing data, so the time count will not
change. This difference is important when preriodicy is
concerned. Changing of time counts will have high impacts on
<a class="reference internal" href="class_ref.html#pydlm.seasonality" title="pydlm.seasonality"><code class="xref py py-class docutils literal"><span class="pre">seasonality</span></code></a> components.</p>
<p><a class="reference internal" href="class_ref.html#pydlm.dlm.ignore" title="pydlm.dlm.ignore"><code class="xref py py-func docutils literal"><span class="pre">dlm.ignore()</span></code></a> simply set the data of a specific date to be None:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">ignore</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="modify-data">
<h3>modify data<a class="headerlink" href="#modify-data" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a> also provides user the ability to modify the data on a
specific date and a specific component. This function enables possible
future extension to interactive anomaly detection and data debugging:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">alter</span><span class="p">(</span><span class="n">date</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">component</span> <span class="o">=</span> <span class="s1">&#39;main&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="model-plotting">
<h2>Model plotting<a class="headerlink" href="#model-plotting" title="Permalink to this headline">¶</a></h2>
<p>This package offers rich ploting options for illustrating the
results. User can simply call <a class="reference internal" href="class_ref.html#pydlm.dlm.plot" title="pydlm.dlm.plot"><code class="xref py py-func docutils literal"><span class="pre">dlm.plot()</span></code></a> to directly plot the
results once the models are fitted:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="c1"># plot the mean of a given component</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">the_component_name</span><span class="p">)</span>

<span class="c1"># plot the latent state of a given component</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">plotCoef</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">the_component_name</span><span class="p">)</span>
</pre></div>
</div>
<p>User can choose which results to plot via <a class="reference internal" href="class_ref.html#pydlm.dlm.turnOn" title="pydlm.dlm.turnOn"><code class="xref py py-func docutils literal"><span class="pre">dlm.turnOn()</span></code></a> and
<a class="reference internal" href="class_ref.html#pydlm.dlm.turnOff" title="pydlm.dlm.turnOff"><code class="xref py py-func docutils literal"><span class="pre">dlm.turnOff()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">turnOn</span><span class="p">(</span><span class="s1">&#39;filtered plot&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">turnOff</span><span class="p">(</span><span class="s1">&#39;predict plot&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">turnOff</span><span class="p">(</span><span class="s1">&#39;smoothed plot&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>User can also choose whether to plot the confidence interval and
whether plot the results in one figure or separate figures. The
default is to plot the confidence interval and in separate plots. To
change that:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">turnOff</span><span class="p">(</span><span class="s1">&#39;confidence&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">turnOff</span><span class="p">(</span><span class="s1">&#39;multiple plots&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The quantile of the confidence interval can be set via
<a class="reference internal" href="class_ref.html#pydlm.dlm.setConfidence" title="pydlm.dlm.setConfidence"><code class="xref py py-func docutils literal"><span class="pre">dlm.setConfidence()</span></code></a>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">setConfidence</span><span class="p">(</span><span class="n">p</span> <span class="o">=</span> <span class="mf">0.95</span><span class="p">)</span>
</pre></div>
</div>
<p>Currently there are two types of confidence interval realization.
The default is &#8216;ribbon&#8217; and the alternative is &#8216;line&#8217;. Users can
change the confidence interval plots by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">setIntervalType</span><span class="p">(</span><span class="s1">&#39;ribbon&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">setIntervalType</span><span class="p">(</span><span class="s1">&#39;line&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The default colors for the plots are:</p>
<blockquote>
<div><ul class="simple">
<li>original data: &#8216;black&#8217;</li>
<li>filtered results: &#8216;blue&#8217;</li>
<li>one-step ahead prediction: &#8216;green&#8217;</li>
<li>smoothed results: &#8216;red&#8217;</li>
</ul>
</div></blockquote>
<p>User can change the color setting via <a class="reference internal" href="class_ref.html#pydlm.dlm.setColor" title="pydlm.dlm.setColor"><code class="xref py py-func docutils literal"><span class="pre">dlm.setColor()</span></code></a>. The color
space is the same as the <cite>matplotlib</cite>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;filtered plot&#39;</span><span class="p">,</span> <span class="s1">&#39;yellow&#39;</span><span class="p">)</span>
<span class="n">myDLM</span><span class="o">.</span><span class="n">setColor</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>If user decide to go back to the original setting, they can use
<a class="reference internal" href="class_ref.html#pydlm.dlm.resetPlotOptions" title="pydlm.dlm.resetPlotOptions"><code class="xref py py-func docutils literal"><span class="pre">dlm.resetPlotOptions()</span></code></a> to reset all the plot option:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">resetPlotOptions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="model-tuning-and-evaluation">
<h2>Model Tuning and evaluation<a class="headerlink" href="#model-tuning-and-evaluation" title="Permalink to this headline">¶</a></h2>
<p>The discounting factor of DLM determines how fast the model adapts to
the new data. It could cause troublesome when users actually want the
model itself to figure that out. The <a class="reference internal" href="class_ref.html#pydlm.modelTuner" title="pydlm.modelTuner"><code class="xref py py-class docutils literal"><span class="pre">modelTuner</span></code></a> provides
users automatic tool for tuning the discounting factors:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pydlm</span> <span class="k">import</span> <span class="n">modelTuner</span>
<span class="n">myTuner</span> <span class="o">=</span> <span class="n">modelTuner</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;gradient_descent&#39;</span><span class="p">,</span> <span class="n">loss</span><span class="o">=</span><span class="s1">&#39;mse&#39;</span><span class="p">)</span>
<span class="n">tunedDLM</span> <span class="o">=</span> <span class="n">myTuner</span><span class="o">.</span><span class="n">tune</span><span class="p">(</span><span class="n">myDLM</span><span class="p">,</span> <span class="n">maxit</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<p>The tuned discounting factor will be set inside the <cite>tunedDLM</cite>. Users
can examine the tuned value from <cite>myTuner</cite>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tuned_discounts</span> <span class="o">=</span> <span class="n">myTuner</span><span class="o">.</span><span class="n">getDiscounts</span><span class="p">()</span>
</pre></div>
</div>
<p>After tuning, <cite>myDLM</cite> will remain unchanged and <cite>tunedDLM</cite> will
contain the tuned discounting factos and will be in uninitialized
status. Users need to run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">tunedDLM</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</pre></div>
</div>
<p>before any other analysis on <cite>tunedDLM</cite>. The <a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a> also provides
a simpler way to tune the discounting factor if the user would like
<cite>myDLM</cite> to be altered directly:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">tune</span><span class="p">()</span>
</pre></div>
</div>
<p>The tuner makes use of the MSE (one-day ahead prediction loss) and the
gradient descent algorithm to tune the discounting factor to achieve
the minimum loss. The discounting factors are assumed to be different
across components but the same within a component. For now, only the
MSE loss and the gradient descent algorithm is supported.</p>
<p>To ease the evaluation of the performance of the model fitting, the
model also provides the residual time series and the one-day a head
prediction error via:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">mse</span> <span class="o">=</span> <span class="n">myDLM</span><span class="o">.</span><span class="n">getMSE</span><span class="p">()</span>
<span class="n">residual</span> <span class="o">=</span> <span class="n">myDLM</span><span class="o">.</span><span class="n">getResidual</span><span class="p">(</span><span class="n">filterType</span><span class="o">=</span><span class="s1">&#39;backwardSmoother&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Users can use these values to evaluate and choose the optimal model.</p>
</div>
<div class="section" id="advanced-settings">
<h2>Advanced Settings<a class="headerlink" href="#advanced-settings" title="Permalink to this headline">¶</a></h2>
<p>This part of settings closely relate to the algorithm behavior and
offers some advanced features, some of which are still under
development. Currently implemented is the <a class="reference internal" href="class_ref.html#pydlm.dlm.stableMode" title="pydlm.dlm.stableMode"><code class="xref py py-func docutils literal"><span class="pre">dlm.stableMode()</span></code></a>
function and the <a class="reference internal" href="class_ref.html#pydlm.dlm.evolveMode" title="pydlm.dlm.evolveMode"><code class="xref py py-func docutils literal"><span class="pre">dlm.evolveMode()</span></code></a>. The <a class="reference internal" href="class_ref.html#pydlm.dlm.stableMode" title="pydlm.dlm.stableMode"><code class="xref py py-func docutils literal"><span class="pre">dlm.stableMode()</span></code></a> is
turned on by default, and you can turn it off by:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">stableModel</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<p>This mode helps increasing the numerical stability of the <a class="reference internal" href="class_ref.html#pydlm.dlm" title="pydlm.dlm"><code class="xref py py-class docutils literal"><span class="pre">dlm</span></code></a>
when small discounting factor is used. Details about discounting
factor will be covered in next section. The <a class="reference internal" href="class_ref.html#pydlm.dlm.evolveMode" title="pydlm.dlm.evolveMode"><code class="xref py py-func docutils literal"><span class="pre">dlm.evolveMode()</span></code></a> is
used to control how different components evolve over time. See
Harrison and West (1999, Page 202). They could
evolve independently, which is equivalent to assume the innovation
matrix is a block-diagonal matrix. The default assumption is
&#8216;independent&#8217; and to change to &#8216;dependent&#8217;, we can simply type:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">myDLM</span><span class="o">.</span><span class="n">evolveMode</span><span class="p">(</span><span class="s1">&#39;dependent&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>The difference between &#8216;independent&#8217; and &#8216;dependent&#8217; is best explained
when there are multiple components with different discounting factor
and one of them is One. In the &#8216;dependent&#8217; mode, the smoothed latent
states of the component with discount factor 1 will be a value
fluctuating around a constant, while in the &#8216;independent&#8217; mode, it
will be an exact constant. User can choose which to use depending on
their own use case.</p>
<p>In the future, following functionalities are planned to be added:
feature selection among dynamic components, factor models for high
dimensional latent states.</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="discounting.html" class="btn btn-neutral float-right" title="The discouting factor" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="example.html" class="btn btn-neutral" title="A simple example" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Xiangyu Wang.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.1.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>